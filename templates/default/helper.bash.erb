#!/bin/bash
#
# This file was generated by chef for <%= node['fqdn'] %>
# DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN BY CHEF CLIENT
#
EYE_BIN=<%= @eye_bin %>
CONFIG_DIR=<%= "/etc/eye/#{@user || 'root'}" %>
RUN_USER=<%= @user || 'root' %>
LOG_FILE=<%= @log_file || '/var/log/eye.log' %>
APPLICATION=<%= @application_name %>

COMMANDS=( break delete history info match monitor restart reload signal start stop trace unmonitor user_command watch check )
COMMAND=$1
PROCCESS=$2

source /etc/eye/functions

check_command() {
  local i
  for i in "${COMMANDS[@]}"
  do
    if [[ "$i" == "$COMMAND" ]];  then
    return 0
    fi
  done
  return 1
}

if check_command; then
  case "$COMMAND" in
    check)
      check_file $(expand_path "$APPLICATION.eye") true
      ;;
    reload)
      load $(expand_path "$APPLICATION.eye")
      ;;
    *)
      if [ ! -z ${PROCCESS} ]; then
        MASK="$APPLICATION:$PROCCESS"
      fi
      execute ${COMMAND} ${MASK}
      ;;
  esac
else
  echo "Unexpected $COMMAND; Usage: $0 {break|delete|history|info|match|monitor|check|restart|reload|signal|start|stop|trace|unmonitor|user_command|watch}"
fi
