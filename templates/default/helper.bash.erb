#!/bin/bash

EYE_BIN=<%= @node['chef_eye']['bin'] %>
CONFIG_DIR=<%= "/etc/eye/#{@resource.owner}" %>
RUN_USER=<%= @resource.owner || 'root' %>
LOG_FILE=<%= @log_file || '/var/log/eye.log' %>
MASK=<%= @resource.name %>
COMMANDS=( break delete history info match monitor restart reload signal start stop trace unmonitor user_command watch check )
COMMAND=$1
PROCCESS=$2

source /etc/eye/functions

check_command() {
    local r=1;
    for i in "${COMMANDS[@]}"
    do
       if [[ $i == "$COMMAND" ]];  then
        r=0
        break
       fi
    done
    return $r
}

if check_command; then
   if [ ! -z $PROCCESS ]; then
     PROJECT="$MASK:$PROCCESS"
   fi
    case "$COMMAND" in
      check)
        check_one "$MASK.eye"
      ;;
      reload)
        reload $MASK
      ;;
      *)
      execute $COMMAND $MASK
      ;;
    esac

else
    echo "Unexpected $COMMAND; Usage: $0 {break|delete|history|info|match|monitor|restart|reload|signal|start|stop|trace|unmonitor|user_command|watch|check}"
fi
